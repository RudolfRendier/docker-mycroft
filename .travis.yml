sudo: required

language: python

services:
  - docker

jobs:
  include:
    - stage: build docker image
      script:
      - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
      - docker build -t docker-mycroft .
      - docker images
      - docker tag docker-mycroft $DOCKER_USERNAME/docker-mycroft
    - stage: test
      script:
      - docker run -d -p 127.0.0.1:8181:8181 --name mycroft-docker $DOCKER_USERNAME/mycroft-docker
      - docker ps | grep -q "mycroft-docker"
    - stage: push
      script:
      - docker push $DOCKER_USERNAME/docker-mycroft
